import{s as v,A as D,r as m,o as w,b as y,a,k,g as x,v as P,h as T,F as V,i as I,B as N,x as B,q as L,f as M,j as S,C as E}from"./index-9d8f7865.js";var U="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",_=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var b=0;b<U.length;b++)_[U.charCodeAt(b)]=b;var F=function(e){var t=e.length*.75,l=e.length,o,n=0,i,d,r,p;e[e.length-1]==="="&&(t--,e[e.length-2]==="="&&t--);var u=new ArrayBuffer(t),g=new Uint8Array(u);for(o=0;o<l;o+=4)i=_[e.charCodeAt(o)],d=_[e.charCodeAt(o+1)],r=_[e.charCodeAt(o+2)],p=_[e.charCodeAt(o+3)],g[n++]=i<<2|d>>4,g[n++]=(d&15)<<4|r>>2,g[n++]=(r&3)<<6|p&63;return u};function R(){return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))}async function W(e,t,l=""){const o=await q(e,l),n=await z(o);return await G(n,t)}async function q(e,t=""){t&&!t.endsWith("/")&&(t+="/");const l=e.split(","),o=l[0].split(":")[1].split(";")[0],n=o.split("/")[1],i=l[l.length-1],{data:d,error:r}=await v.storage.from("coffee-images").upload(`public/${t}${R()}.${n}`,F(i),{cacheControl:"3600",upsert:!1,contentType:o});return r?(console.error(r),""):d.path}async function z(e){const{data:t}=v.storage.from("coffee-images").getPublicUrl(e);return t.publicUrl?t.publicUrl:(console.error(t),"")}async function G(e,t){const{data:l,error:o}=await v.from("images").insert({url:e,storage_vendor:"supabase",user:t}).select();return o?(console.error(o),""):l[0].id}const H={class:"w-full text-gray-500"},J={class:"flex w-full justify-end"},K={key:0,class:"absolute m-1 h-fit rounded-full bg-blue-600 p-2 text-justify text-xs font-bold text-white"},O={id:"all-current-producers"},Q=["value"],X={__name:"SelectProducer",props:{selectedProducer:{},selectedProducerModifiers:{}},emits:["update:selectedProducer"],setup(e){const t=D(e,"selectedProducer"),l=m(""),o=m([]);async function n(){const{data:d,error:r}=await v.from("producers").select("id, name");if(r){console.error(r);return}const p=d.sort((u,g)=>u.name.localeCompare(g.name));o.value=p}n();function i(){const d=o.value.filter(r=>r.name.toLowerCase()===l.value.toLowerCase());d.length>0?t.value=d[0]:t.value={name:l.value,id:null}}return(d,r)=>{var p;return w(),y("form",{onSubmit:r[2]||(r[2]=N(u=>i(),["prevent"]))},[a("label",H,[k("Producer "),a("div",J,[x(a("input",{type:"text",class:"border-grey-light block w-full rounded border p-3",list:"all-current-producers","onUpdate:modelValue":r[0]||(r[0]=u=>l.value=u),onInput:r[1]||(r[1]=u=>i()),"e2e-id":"input-producer-name"},null,544),[[P,l.value]]),((p=t.value)==null?void 0:p.id)==null&&l.value.length>0?(w(),y("div",K," NEW ")):T("",!0)])]),a("datalist",O,[(w(!0),y(V,null,I(o.value,u=>(w(),y("option",{value:u.name},null,8,Q))),256))])],32)}}},Y={class:"flex h-full w-full justify-center md:mt-8"},Z={class:"flex h-full w-full flex-col justify-start rounded-lg bg-white shadow-lg lg:w-3/4"},ee={class:"flex h-full w-full flex-col justify-start md:flex-row"},re={class:"w-full p-4 md:w-1/2"},te={class:"text-gray-500"},oe={class:"text-gray-500"},ae={class:"m-2 h-full rounded-xl p-2 outline outline-gray-400 md:w-1/2"},ne=["src"],se={__name:"AddDrink",setup(e){const{userId:t,isUserVerified:l}=B("userName"),o=m([]),n=m(null),i=m(""),d=m(""),r=m(""),p=m(""),u=L.useToast({position:"top"});async function g(){const{data:f,error:s}=await v.from("producers").select("id, name");if(s){console.error(s);return}const c=f.sort((h,j)=>h.name.localeCompare(j.name));o.value=c}async function C(){const{data:f,error:s}=await v.from("producers").insert({name:n.value.name}).select("id");if(s){u.error("There was an error creating the producer");return}n.value.id=f[0].id}async function A(){var h;if(!l())return;if(!r.value){u.error("The Drink most have a name");return}if(!((h=n.value)!=null&&h.name)){u.error("The Drink most have a producer");return}n.value.id||await C();const f=`drinks/${n.value.id}`;let s=null;i.value&&(s=await W(i.value,t.value,f));const{error:c}=await v.from("drinks").insert({name:r.value,description:p.value,producer:n.value.id,user_id:t.value,image:s});if(c){u.error("There was an error uploading your drink");return}u.success(`${r.value} has been added`),E.push({path:"/"})}function $(f){const s=f.target.files[0],c=new FileReader;c.readAsDataURL(s),c.onload=h=>{d.value=s.type,i.value=h.target.result}}return g(),(f,s)=>(w(),y("div",Y,[a("div",Z,[a("div",ee,[a("div",re,[a("div",null,[a("label",te,[k("Name of the drink "),x(a("input",{type:"text",class:"border-grey-light mb-4 block w-full rounded border p-3",name:"drinkName","onUpdate:modelValue":s[0]||(s[0]=c=>r.value=c),placeholder:"Name of the drink","e2e-id":"input-drink-name"},null,512),[[P,r.value]])])]),a("div",null,[a("label",oe,[k("Description of the drink "),x(a("input",{type:"text",class:"border-grey-light mb-4 block w-full rounded border p-3",name:"drinkDescription","onUpdate:modelValue":s[1]||(s[1]=c=>p.value=c),placeholder:"Description of the drink","e2e-id":"input-drink-description"},null,512),[[P,p.value]])])]),M(X,{selectedProducer:n.value,"onUpdate:selectedProducer":s[2]||(s[2]=c=>n.value=c)},null,8,["selectedProducer"])]),a("label",ae,[a("input",{type:"file",class:"hidden",accept:"image/jpeg, image/png, image/jpg, image/webp",onChange:$,"e2e-id":"input-drink-image"},null,32),x(a("span",null," Upload a image ",512),[[S,!i.value]]),a("img",{src:i.value,class:"h-full w-full"},null,8,ne)])]),a("div",{class:"flex justify-center"},[a("button",{type:"button",class:"button md:w-4/5",onClick:A,"e2e-id":"input-drink-submit"}," Upload ")])])]))}};export{se as default};
